{"version":3,"sources":["../../../../../../src/app/launcher/create-app/project-progress-createapp-nextstep/project-progress-createapp-nextstep.component.ts"],"names":[],"mappings":"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","file":"project-progress-createapp-nextstep.component.js","sourceRoot":"","sourcesContent":["import {\n  Component,\n  Host,\n  Input,\n  OnDestroy,\n  ViewEncapsulation,\n  OnChanges,\n  SimpleChanges,\n  SimpleChange\n} from '@angular/core';\n\nimport { Progress } from '../../model/progress.model';\nimport { ProjectProgressService } from '../../service/project-progress.service';\nimport { LauncherComponent } from '../../launcher.component';\nimport { ProjectSummaryService } from '../../../../..';\n\n\nexport class ProjectProgressCreateappNextstepComponent implements OnChanges, OnDestroy {\n   statusLink: string;\n  errorMessage: string;\n  private _progress: Progress[];\n  private socket: WebSocket;\n\n  constructor( public launcherComponent: LauncherComponent,\n    private projectProgressService: ProjectProgressService,\n    private projectSummaryService: ProjectSummaryService) {\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    const statusLink = changes['statusLink']['currentValue'];\n    if (statusLink) {\n      this.socket = this.projectProgressService.getProgress(statusLink);\n      this.socket.onmessage = (event: MessageEvent) => {\n        if (!this._progress) {\n          this._progress = [];\n          let values = JSON.parse(event.data);\n          console.log('data from Create ws', values);\n          for (let item of values) {\n            for (let key in item) {\n              if (item.hasOwnProperty(key)) {\n                this._progress.push({ key: key, description: item[key] } as Progress);\n              }\n            }\n          }\n        } else {\n          let message = JSON.parse(event.data);\n          console.log('data from ws', message);\n          let data = message.data || {};\n          if (data && data.error) {\n            console.log(message.data.error);\n            this.errorMessage = data.error;\n            for (let i = this.lastCompleted; i < this._progress.length; i++) {\n              this._progress[i].error = true;\n            }\n            this.socket.close();\n          } else {\n            for (let status of this._progress) {\n              if (status.key === message.statusMessage) {\n                status.completed = true;\n                if (data.location != null) {\n                  status.hyperText = data.location;\n                }\n                break;\n              }\n            }\n          }\n        }\n      };\n      this.socket.onerror = (error: ErrorEvent) => {\n        console.log('error in fetching messages in progress Component: Create', error);\n      };\n      this.socket.onclose = () => {\n        console.log('closed the socket call in progress component in Create');\n      };\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  }\n\n  private get lastCompleted(): number {\n    return this._progress ? this._progress.findIndex(item => !item.completed) : -1;\n  }\n\n  retry() {\n    const failedStep = this.lastCompleted;\n    this.projectSummaryService.setup(\n      this.launcherComponent.summary, failedStep).subscribe(result => {\n        this._progress = null;\n        this.errorMessage = null;\n        this.ngOnChanges({'statusLink': new SimpleChange('', result.uuid_link, false)});\n      });\n  }\n\n  // Accessors\n\n  get allCompleted(): boolean {\n    return this._progress ? !this._progress.find(item => !item.completed) : false;\n  }\n\n  get isError(): boolean {\n    return !!this.errorMessage;\n  }\n\n  getProgressByKey(key: string): Progress {\n    for (let status of this._progress) {\n      if (status.key === key) {\n        return status;\n      }\n    }\n    return {} as Progress;\n  }\n\n  get progress(): Progress[] {\n    return this._progress;\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  encapsulation: ViewEncapsulation.None,\n  selector: 'f8launcher-projectprogress-createapp-nextstep',\n  templateUrl: './project-progress-createapp-nextstep.component.html',\n  styleUrls: ['./project-progress-createapp-nextstep.component.less']\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: LauncherComponent, decorators: [{ type: Host }, ]},\n{type: ProjectProgressService, },\n{type: ProjectSummaryService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'statusLink': [{ type: Input },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}